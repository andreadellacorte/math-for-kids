"use strict";(()=>{var a=class{constructor(){this.audioContext=null;this.timeLeft=60;this.currentProblem=0;this.correctAnswers=0;this.totalProblems=0;this.startTime=null;this.problemStartTime=null;this.responseTimes=[];this.gameActive=!1;this.currentAnswer=null;this.hintTimer=null;this.equationQueue=[];this.currentEquation=null;this.selectedDifficulty="medium";this.inputMode="button";this.gameTimer=null;this.keyboardMode=!1;this.assistedMode=!1;this.correctAnswerButton=null;this.completedProblems={};this.currentEquationIndex=0;this.setupElements(),this.resetGame(),this.bindEvents()}setupElements(){this.setupScreen=document.getElementById("setupScreen"),this.gameScreen=document.getElementById("gameScreen"),this.resultsScreen=document.getElementById("resultsScreen"),this.difficultyButtons=document.querySelectorAll(".difficulty-btn"),this.timeLimitSlider=document.getElementById("timeLimit"),this.timeDisplay=document.getElementById("timeDisplay"),this.buttonModeRadio=document.getElementById("buttonMode"),this.assistedModeRadio=document.getElementById("assistedMode"),this.keyboardModeRadio=document.getElementById("keyboardInputMode"),this.startBtn=document.getElementById("startBtn"),this.timer=document.getElementById("timer"),this.problemCounter=document.getElementById("problemCounter"),this.accuracy=document.getElementById("accuracy"),this.progressFill=document.getElementById("progressFill"),this.equationsContainer=document.getElementById("equationsContainer"),this.equationItems=[];for(let e=0;e<5;e++)this.equationItems[e]=document.getElementById(`equation-${e}`);this.keyboardInput=document.getElementById("keyboardInput"),this.answerInput=document.getElementById("answerInput"),this.submitBtn=document.getElementById("submitBtn"),this.answerOptions=document.getElementById("answerOptions"),this.playAgainBtn=document.getElementById("playAgainBtn"),this.shareSocreBtn=document.getElementById("shareSocreBtn"),this.feedbackOverlay=document.getElementById("feedbackOverlay"),this.playerNameInput=document.getElementById("playerNameInput"),this.playerNameDisplay=document.getElementById("playerNameDisplay"),this.printCertificateBtn=document.getElementById("printCertificateBtn"),this.setupAudio()}setupAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{this.audioContext=null}}playSound(e,t,i=.1){if(this.audioContext)try{let s=this.audioContext.createOscillator(),o=this.audioContext.createGain();s.connect(o),o.connect(this.audioContext.destination),s.frequency.value=e,s.type="sine",o.gain.setValueAtTime(0,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.01),o.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+t),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+t)}catch{}}resetGame(){this.timeLeft=parseInt(this.timeLimitSlider.value)||60,this.currentProblem=0,this.correctAnswers=0,this.totalProblems=0,this.startTime=null,this.problemStartTime=null,this.responseTimes=[],this.gameActive=!1,this.currentAnswer=null,this.hintTimer=null,this.equationQueue=[],this.currentEquationIndex=0,this.completedProblems=[],this.keyboardMode=!1,this.initializeEquationQueue(),this.assistedMode=this.assistedModeRadio.checked,this.keyboardMode=this.keyboardModeRadio.checked,this.selectedDifficulty=document.querySelector(".difficulty-btn.selected")?.dataset.difficulty||"easy",this.loadSettings()}setCookie(e,t,i=365){let s=new Date;s.setTime(s.getTime()+i*24*60*60*1e3),document.cookie=`${e}=${encodeURIComponent(t)};expires=${s.toUTCString()};path=/;SameSite=Lax`}getCookie(e){let t=document.cookie.split(";").map(i=>i.trim()).find(i=>i.startsWith(e+"="));return t?decodeURIComponent(t.split("=")[1]):null}loadSettings(){let e=this.getCookie("inputMode");if(e!==null)switch(this.buttonModeRadio.checked=!1,this.assistedModeRadio.checked=!1,this.keyboardModeRadio.checked=!1,e){case"button":this.buttonModeRadio.checked=!0,this.assistedMode=!1,this.keyboardMode=!1;break;case"assisted":this.assistedModeRadio.checked=!0,this.assistedMode=!0,this.keyboardMode=!1;break;case"keyboard":this.keyboardModeRadio.checked=!0,this.assistedMode=!1,this.keyboardMode=!0;break;default:this.buttonModeRadio.checked=!0,this.assistedMode=!1,this.keyboardMode=!1}let t=this.getCookie("timeLimit");t!==null&&(this.timeLimitSlider.value=t,this.timeDisplay.textContent=`${t}s`);let i=this.getCookie("difficulty");if(i!==null){this.difficultyButtons.forEach(n=>n.classList.remove("selected"));let o=document.querySelector(`[data-difficulty="${i}"]`);o&&(o.classList.add("selected"),this.selectedDifficulty=i)}this.updateInputModeDisplay();let s=this.getCookie("playerName");s&&(this.playerNameInput.value=s)}saveSettings(){let e="button";this.assistedModeRadio.checked?e="assisted":this.keyboardModeRadio.checked&&(e="keyboard"),this.setCookie("inputMode",e),this.setCookie("timeLimit",this.timeLimitSlider.value),this.setCookie("difficulty",this.selectedDifficulty);let t=(this.playerNameInput?.value||"").trim();t&&this.setCookie("playerName",t)}initializeEquationQueue(){this.equationQueue=[];for(let e=0;e<5;e++)this.equationQueue.push(this.generateProblem());for(let e=0;e<10;e++)this.equationQueue.push(this.generateProblem());this.updateEquationDisplay()}updateEquationDisplay(){for(let e=0;e<5;e++){let t=this.equationItems[e],i=t.querySelector(".equation-text"),s=t.querySelector(".equation-status");t.classList.remove("completed","current","future");let o;this.currentProblem<3?o=e:o=this.currentProblem-2+e;let n=this.equationQueue[o];if(o<this.currentProblem){if(t.classList.add("completed"),n){i.textContent=`${n.num1} ${n.operation} ${n.num2} = ${n.answer}`;let r=this.completedProblems[o]?.correct??!0;s.textContent=r?"\u2713":"\u2717",s.style.color=r?"#28a745":"#dc3545"}}else o===this.currentProblem?(t.classList.add("current"),n?(i.textContent=`${n.num1} ${n.operation} ${n.num2} = ?`,s.textContent="\u276F"):(i.textContent="Get Ready...",s.textContent="\u276F")):(t.classList.add("future"),n?i.textContent=`${n.num1} ${n.operation} ${n.num2} = ?`:i.textContent="Loading...",s.textContent="\u22EF")}}moveToNextEquation(e){for(this.completedProblems[this.currentProblem]={correct:e},this.currentProblem++;this.equationQueue.length<=this.currentProblem+5;)this.equationQueue.push(this.generateProblem());let t=this.equationQueue[this.currentProblem];t&&(this.currentAnswer=t.answer),this.keyboardMode&&(this.answerInput.value="",setTimeout(()=>{this.answerInput.focus(),this.answerInput.select()},100)),this.animateEquationScroll()}animateEquationScroll(){this.equationsContainer.classList.add("transitioning"),setTimeout(()=>{this.updateEquationDisplay(),this.equationsContainer.classList.remove("transitioning")},200)}updateInputModeDisplay(){this.keyboardMode?(this.answerOptions.style.display="none",this.keyboardInput.style.display="flex"):(this.answerOptions.style.display="grid",this.keyboardInput.style.display="none")}toggleInputMode(){this.keyboardMode=!this.keyboardMode,this.keyboardMode?(this.answerOptions.style.display="none",this.keyboardInput.style.display="flex",this.toggleInputBtn.textContent="Use Buttons",this.answerInput.focus()):(this.answerOptions.style.display="grid",this.keyboardInput.style.display="none",this.toggleInputBtn.textContent="Use Keyboard"),this.answerInput.value=""}submitKeyboardAnswer(){if(!this.gameActive||!this.keyboardMode)return;let e=parseInt(this.answerInput.value);if(isNaN(e)){this.answerInput.focus();return}let t=parseInt(this.currentAnswer),i=e===t;this.handleAnswer(i),this.answerInput.value="",this.answerInput.focus()}handleAnswer(e){if(!this.gameActive)return;let t=Date.now()-this.problemStartTime;this.responseTimes.push(t),this.showFeedback(e),e?this.playSound(523,.2):(setTimeout(()=>this.playSound(250,.1),100),setTimeout(()=>this.playSound(200,.2),200)),e&&this.correctAnswers++,this.totalProblems++,this.moveToNextEquation(e),this.updateUI(),setTimeout(()=>{this.timeLeft>0&&this.gameActive&&this.showProblem()},800)}bindEvents(){this.startBtn.addEventListener("click",()=>this.startGame()),this.playAgainBtn.addEventListener("click",()=>this.showSetup()),this.shareSocreBtn.addEventListener("click",()=>this.shareScore()),this.submitBtn.addEventListener("click",()=>this.submitKeyboardAnswer()),this.printCertificateBtn.addEventListener("click",()=>this.printCertificate()),this.playerNameInput.addEventListener("input",()=>{this.setCookie("playerName",this.playerNameInput.value)}),this.answerInput.addEventListener("keypress",e=>{e.key==="Enter"&&this.submitKeyboardAnswer()}),document.addEventListener("keydown",e=>{if(!this.gameActive||this.keyboardMode)return;let t=this.answerOptions.querySelectorAll(".answer-btn");if(t.length!==4)return;let i=null;switch(e.key){case"ArrowLeft":i=t[0],e.preventDefault();break;case"ArrowUp":i=t[1],e.preventDefault();break;case"ArrowDown":i=t[2],e.preventDefault();break;case"ArrowRight":i=t[3],e.preventDefault();break}if(i&&i.style.pointerEvents!=="none"){let s=i.textContent;this.selectAnswer(s,i)}}),this.difficultyButtons.forEach(e=>{e.addEventListener("click",()=>{this.difficultyButtons.forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),this.selectedDifficulty=e.dataset.difficulty,this.saveSettings()})}),[this.buttonModeRadio,this.assistedModeRadio,this.keyboardModeRadio].forEach(e=>{e.addEventListener("change",()=>{e.checked&&(this.assistedMode=this.assistedModeRadio.checked,this.keyboardMode=this.keyboardModeRadio.checked,this.updateInputModeDisplay(),this.keyboardMode&&this.gameActive&&setTimeout(()=>this.answerInput.focus(),100),this.saveSettings())})}),this.timeLimitSlider.addEventListener("input",()=>{this.timeDisplay.textContent=`${this.timeLimitSlider.value}s`,this.saveSettings()})}generateProblem(){let e=this.selectedDifficulty,t,i,s,o;switch(e){case"easy":t=Math.floor(Math.random()*9)+1,i=Math.floor(Math.random()*9)+1,s=Math.random()<.8?"+":"-",s==="-"&&t<i&&([t,i]=[i,t]);break;case"medium":t=Math.floor(Math.random()*90)+10,i=Math.floor(Math.random()*9)+1,s=Math.random()<.6?"+":"-";break;case"hard":t=Math.floor(Math.random()*90)+10,i=Math.floor(Math.random()*90)+10,s=Math.random()<.5?"+":"-";break;case"expert":t=Math.floor(Math.random()*900)+100,i=Math.floor(Math.random()*90)+10;let n=["+","-","\xD7","\xF7"];s=n[Math.floor(Math.random()*n.length)];break}switch(s){case"+":o=t+i;break;case"-":e!=="easy"&&t<i&&([t,i]=[i,t]),o=t-i;break;case"\xD7":t=Math.floor(Math.random()*12)+1,i=Math.floor(Math.random()*12)+1,o=t*i;break;case"\xF7":o=Math.floor(Math.random()*12)+1,i=Math.floor(Math.random()*9)+2,t=o*i;break}return{num1:t,num2:i,operation:s,answer:o}}showProblem(){let e=this.equationQueue[this.currentProblem];if(!e)return;this.currentAnswer=e.answer,this.updateInputModeDisplay(),this.keyboardMode&&setTimeout(()=>this.answerInput.focus(),100),this.hintTimer&&(clearTimeout(this.hintTimer),this.hintTimer=null);let t=this.generateOptions(e.answer);this.answerOptions.innerHTML="";let i=["\u2190","\u2191","\u2193","\u2192"];t.forEach((s,o)=>{let n=document.createElement("button");n.className="answer-btn";let r=document.createElement("span");r.className="arrow-hint",r.textContent=i[o],r.style.cssText="position: absolute; top: 4px; right: 8px; opacity: 0.4; font-size: 0.8em;",n.textContent=s,n.style.position="relative",n.appendChild(r),n.addEventListener("click",()=>this.selectAnswer(s,n)),s===this.currentAnswer&&(this.correctAnswerButton=n),this.answerOptions.appendChild(n)}),this.problemStartTime=Date.now(),this.assistedMode&&(this.hintTimer=setTimeout(()=>{this.correctAnswerButton&&this.gameActive&&this.correctAnswerButton.classList.add("hint")},3e3))}generateOptions(e){let t=[e],i=Math.max(10,Math.floor(e*.5));for(;t.length<4;){let s;Math.random()<.5?s=e+Math.floor(Math.random()*i)-Math.floor(i/2):s=Math.floor(Math.random()*(e*2))+1,s>0&&!t.includes(s)&&t.push(s)}return t.sort(()=>Math.random()-.5)}selectAnswer(e,t){if(!this.gameActive)return;this.hintTimer&&(clearTimeout(this.hintTimer),this.hintTimer=null),document.querySelectorAll(".answer-btn.hint").forEach(r=>{r.classList.remove("hint")});let i=parseInt(e),s=parseInt(this.currentAnswer),o=i===s;t.classList.add(o?"correct":"incorrect"),this.answerOptions.querySelectorAll(".answer-btn").forEach(r=>r.style.pointerEvents="none"),this.handleAnswer(o)}showFeedback(e){this.feedbackOverlay.textContent=e?"\u2713 Correct!":"\u2717 Wrong!",this.feedbackOverlay.className=`feedback-overlay ${e?"correct":"incorrect"}`,this.feedbackOverlay.offsetHeight,setTimeout(()=>{this.feedbackOverlay.className="feedback-overlay"},600)}skipProblem(){this.gameActive&&(this.totalProblems++,this.moveToNextEquation(!1),this.responseTimes.push(1e4),this.updateUI(),this.timeLeft>0&&this.showProblem())}updateUI(){let e=this.totalProblems>0?Math.round(this.correctAnswers/this.totalProblems*100):100;this.accuracy.textContent=`${e}%`,this.problemCounter.textContent=`${this.currentProblem}`;let t=Math.min(this.currentProblem/60*100,100);this.progressFill.style.width=`${t}%`}updateTimer(){this.timer.textContent=this.timeLeft,this.timeLeft<=10?this.timer.className="timer danger":this.timeLeft<=20?this.timer.className="timer warning":this.timer.className="timer",this.timeLeft<=0?this.endGame():this.timeLeft--}calculateBrainAge(){let e=this.totalProblems>0?this.correctAnswers/this.totalProblems:0,t=this.responseTimes.length>0?this.responseTimes.reduce((o,n)=>o+n,0)/this.responseTimes.length:5e3,i={easy:1.2,medium:1,hard:.8,expert:.6}[this.selectedDifficulty],s=20;return s+=(1-e)*40,s+=Math.min(t/1e3*5,30),s*=i,s-=Math.min(this.totalProblems*.2,10),Math.max(8,Math.min(80,Math.round(s)))}startGame(){this.resetGame(),this.gameActive=!0,this.showScreen("game"),this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume(),this.gameTimer=setInterval(()=>this.updateTimer(),1e3),this.updateEquationDisplay(),this.showProblem(),this.keyboardMode&&setTimeout(()=>{this.answerInput.focus(),this.answerInput.select()},100)}endGame(){this.gameActive=!1,clearInterval(this.gameTimer),this.hintTimer&&(clearTimeout(this.hintTimer),this.hintTimer=null);let e=this.calculateBrainAge(),t=this.totalProblems>0?Math.round(this.correctAnswers/this.totalProblems*100):0,i=this.responseTimes.length>0?(this.responseTimes.reduce((n,r)=>n+r,0)/this.responseTimes.length/1e3).toFixed(1):"0.0",s={easy:"Easy",medium:"Medium",hard:"Hard",expert:"Expert"};document.getElementById("brainAge").textContent=`Brain Age: ${e}`,document.getElementById("finalProblems").textContent=this.totalProblems,document.getElementById("finalAccuracy").textContent=`${t}%`,document.getElementById("avgTime").textContent=`${i}s`,document.getElementById("finalDifficulty").textContent=s[this.selectedDifficulty];let o=(this.playerNameInput.value||"").trim();o?(this.playerNameDisplay.textContent=o,this.playerNameDisplay.style.display="",this.playerNameInput.style.display="none"):(this.playerNameDisplay.style.display="none",this.playerNameInput.style.display=""),document.getElementById("certAge").textContent=e,document.getElementById("certProblems").textContent=this.totalProblems,document.getElementById("certAccuracy").textContent=`${t}%`,document.getElementById("certAvg").textContent=`${i}s`,document.getElementById("certLevel").textContent=s[this.selectedDifficulty];try{let n=new Date().toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});document.getElementById("certDate").textContent=n}catch{}this.showScreen("results")}printCertificate(){let e=document.getElementById("certificate");if(!e)return;let t=`<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Brain Training Certificate</title>
  <style>
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body { margin: 16mm; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .certificate { border: 6px double #2d3748; border-radius: 16px; padding: 30px; }
    @page { size: A4; margin: 12mm; }
  </style>
  <link rel="stylesheet" href="${location.origin+location.pathname.replace(/\/[^/]*$/,"/")+"styles.css"}">
  <style>${document.querySelector("style")?.textContent||""}</style>
  </head>
<body>
  ${e.outerHTML}
  <script>window.onload = function(){ setTimeout(function(){ window.print(); }, 100); };<\/script>
</body>
</html>`,i=window.open("","_blank");i&&(i.document.open(),i.document.write(t),i.document.close())}shareScore(){let e=document.getElementById("brainAge").textContent,t=document.getElementById("finalAccuracy").textContent,i=document.getElementById("finalProblems").textContent,s=`\u{1F9E0} I just completed Brain Training Speed Math!
${e}, solved ${i} problems with ${t} accuracy!

Try it yourself: ${window.location.href}`;navigator.share?navigator.share({title:"Brain Training Speed Math Results",text:s}):navigator.clipboard.writeText(s).then(()=>{alert("Score copied to clipboard!")})}showScreen(e){switch(this.setupScreen.classList.add("hidden"),this.gameScreen.classList.add("hidden"),this.resultsScreen.classList.add("hidden"),e){case"setup":this.setupScreen.classList.remove("hidden");break;case"game":this.gameScreen.classList.remove("hidden");break;case"results":this.resultsScreen.classList.remove("hidden");break}}showSetup(){this.resetGame(),this.showScreen("setup")}};new a;})();
