"use strict";(()=>{(function(){let v=document.getElementById("items"),l=document.getElementById("receipt"),M=document.getElementById("notes"),b=document.getElementById("coins"),E=document.getElementById("cashSlot"),g=document.getElementById("chips"),h=document.getElementById("status"),T=document.getElementById("finishBtn"),m=document.getElementById("padDisplay"),B=document.getElementById("helpBtn"),f=document.getElementById("hintMsg"),u=document.getElementById("discountsList"),C=[],H=null,r=0,i=0,p=[],L=0,d=[],N=[50,20,10,5],k=[2,1,.5,.2,.1,.05,.01],A=[{name:"Milk",price:1.2,barcode:"M-001"},{name:"Bread",price:.9,barcode:"B-002"},{name:"Eggs",price:1.8,barcode:"E-003"},{name:"Apples",price:1.1,barcode:"A-004"},{name:"Pasta",price:1.5,barcode:"P-005"},{name:"Juice",price:1.3,barcode:"J-006"},{name:"Cereal",price:2.7,barcode:"C-007"},{name:"Cheese",price:2.1,barcode:"C-008"},{name:"Yogurt",price:.8,barcode:"Y-009"}];function a(e){return e.toFixed(2)}function w(){C=[],r=0,i=0,H=null,l.innerHTML="",f.textContent="",d=[],u&&(u.innerHTML='<div class="discount">No discounts</div>')}function S(){let e=Math.floor(Math.random()*3)+3,t=[...A],n=[];for(let o=0;o<e;o++){let s=t.splice(Math.floor(Math.random()*t.length),1)[0];n.push(s)}v.innerHTML="",n.forEach(o=>{let s=document.createElement("div");s.className="item",s.innerHTML=`<div>${o.name}</div><div class="price">\xA3${a(o.price)}</div><div class="barcode">${o.barcode}</div>`,s.addEventListener("click",()=>O(o)),v.appendChild(s)}),d=[];let c=()=>Math.floor(Math.random()*n.length);if(n.length>0){let o=n[c()].name,s=[10,15,20][Math.floor(Math.random()*3)];d.push({type:"percent",item:o,percent:s})}if(n.length>1&&Math.random()<.6){let o=n[c()].name,s=0;for(;d.some(J=>J.item===o)&&s++<5;)o=n[c()].name;let Y=[.1,.2,.5][Math.floor(Math.random()*3)];d.push({type:"amount",item:o,amount:Y})}D()}function D(){if(u.innerHTML="",d.length===0){u.innerHTML='<div class="discount">No discounts</div>';return}d.forEach(e=>{let t=document.createElement("div");t.className="discount",e.type==="percent"?t.textContent=`${e.item}: ${e.percent}% off`:t.textContent=`${e.item}: \xA3${a(e.amount)} off`,u.appendChild(t)})}function y(e){let t=0,n="";return d.forEach(c=>{if(c.item===e.name){if(c.type==="percent"){let o=Math.round(e.price*(c.percent/100)*100)/100;o>t&&(t=o,n=`${c.percent}% off`)}else if(c.type==="amount"){let o=Math.min(c.amount,e.price);o>t&&(t=o,n=`\xA3${a(o)} off`)}}}),{amount:t,label:n}}function O(e){C.push(e);let t=document.createElement("div");t.className="receipt-line",t.innerHTML=`<span>${e.name}</span><span>\xA3${a(e.price)}</span>`,l.appendChild(t),r=Math.round((r+e.price)*100)/100;let n=y(e);if(n.amount>0){let c=document.createElement("div");c.className="receipt-line",c.innerHTML=`<span>\u2014 Discount (${n.label})</span><span>-\xA3${a(n.amount)}</span>`,l.appendChild(c),r=Math.round((r-n.amount)*100)/100}h.textContent="Added "+e.name+" to receipt"}function F(){M.innerHTML="",b.innerHTML="",N.forEach(e=>{let t=document.createElement("button");t.className="note",t.textContent="\xA3"+e,t.addEventListener("click",()=>I(e)),M.appendChild(t)}),k.forEach(e=>{let t=document.createElement("button");t.className="coin",t.textContent="\xA3"+a(e),t.addEventListener("click",()=>I(e)),b.appendChild(t)})}function I(e){i=Math.round((i+e)*100)/100,p.push(e),E.textContent="Inserted: \xA3"+a(i),$()}function $(){if(g.innerHTML="",p.length===0){g.innerHTML='<div style="opacity:0.7;">\u2014</div>';return}p.forEach((e,t)=>{let n=document.createElement("button");n.className="chip",n.textContent="\xA3"+a(e),n.title="Remove this",n.addEventListener("click",()=>G(t)),g.appendChild(n)})}function G(e){let t=p[e];p.splice(e,1),i=Math.round((i-t)*100)/100,E.textContent="Inserted: \xA3"+a(i),$()}function V(){r=0,l.innerHTML="",C.forEach(e=>{let t=document.createElement("div");t.className="receipt-line",t.innerHTML=`<span>${e.name}</span><span>\xA3${a(e.price)}</span>`,l.appendChild(t),r=Math.round((r+e.price)*100)/100;let n=y(e);if(n.amount>0){let c=document.createElement("div");c.className="receipt-line",c.innerHTML=`<span>\u2014 Discount (${n.label})</span><span>-\xA3${a(n.amount)}</span>`,l.appendChild(c),r=Math.round((r-n.amount)*100)/100}})}function P(){if(C.length===0){f.textContent="Add items first.";return}let e=Math.round(r*100)/100;i<e?f.textContent=`You need \xA3${a(e-i)} more.`:f.textContent=`Change should be \xA3${a(i-e)}.`}function R(){let e=Math.round(r*100)/100,t=Math.round((i-e)*100)/100,n=`Subtotal \xA3${a(e)}. `;i<e?n+=`Short by \xA3${a(e-i)}.`:i===e?n+="Exact payment. Great job!":n+=`Change due \xA3${a(t)}.`;let c=Math.round((performance.now()-L)/1e3),o=3;i<e?o=1:c>45&&(o=2),i===e?(h.textContent=`\u{1F389} CONGRATULATIONS! ${n} \u23F1\uFE0F ${c}s \u2B50 ${"\u2605".repeat(o)}${"\u2606".repeat(3-o)}`,setTimeout(()=>x(),1200)):h.textContent=`${n} \u23F1\uFE0F ${c}s \u2B50 ${"\u2605".repeat(o)}${"\u2606".repeat(3-o)}`}function x(){w(),S(),F(),E.textContent="Insert payment here",h.textContent="New order loaded. Click items to add, then Evaluate.",L=performance.now()}function U(){R()}(function(){let t="";m.textContent="0.00",document.querySelectorAll(".pad-btn").forEach(n=>{n.addEventListener("click",()=>{let c=n.textContent.trim();if(c==="C"){t="",m.textContent="0.00";return}if(c==="="){try{let o=Function("return "+t)();m.textContent=isFinite(o)?String(o):"Err"}catch{m.textContent="Err"}return}c==="+"||c==="-"?t+=" "+c+" ":t+=c,m.textContent=t})})})(),T.addEventListener("click",U),B.addEventListener("click",P),x()})();})();
