(()=>{var se=Object.create;var q=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var le=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var S=(l=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(l,{get:(f,c)=>(typeof require<"u"?require:f)[c]}):l)(function(l){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+l+'" is not supported')});var de=(l,f,c,d)=>{if(f&&typeof f=="object"||typeof f=="function")for(let x of ie(f))!ce.call(l,x)&&x!==c&&q(l,x,{get:()=>f[x],enumerable:!(d=re(f,x))||d.enumerable});return l};var C=(l,f,c)=>(c=l!=null?se(le(l)):{},de(f||!l||!l.__esModule?q(c,"default",{value:l,enumerable:!0}):c,l));var r=C(S("https://esm.sh/three@0.152.2")),O=C(S("https://esm.sh/oimo")),D=S("https://esm.sh/three@0.152.2/examples/jsm/controls/OrbitControls.js"),W=S("https://esm.sh/three@0.152.2/examples/jsm/geometries/RoundedBoxGeometry.js");(function(){let l=document.getElementById("dice3d"),f=document.getElementById("hud"),c=document.getElementById("rollBtn"),d=document.getElementById("stopBtn"),x=document.getElementById("resetBtn"),F=document.getElementById("statusToast"),G=document.getElementById("amountLabel"),$=document.getElementById("totalLabel"),Q=document.getElementById("turnLabel"),N=document.getElementById("playerDot"),B=document.getElementById("prescreen"),U=document.getElementById("onePlayer"),j=document.getElementById("twoPlayers"),P=101,L={pink:"#ffd1dc",blue:"#cce5ff"},n={numPlayers:0,currentPlayerIdx:0,players:[{name:"Player 1",color:L.blue,total:0},{name:"Player 2",color:L.pink,total:0}],rolling:!1,diceEntities:[],world:null,scene:null,camera:null,renderer:null,controls:null,settleTimer:0};function u(o){F.textContent=o}function X(){let o=l.clientWidth,e=l.clientHeight,t=new r.WebGLRenderer({antialias:!0,alpha:!0});t.shadowMap.enabled=!0,t.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),t.setSize(o,e),l.appendChild(t.domElement);let s=new r.Scene,a=new r.PerspectiveCamera(50,o/e,.1,1e3);a.position.set(-10,14,14),a.lookAt(0,0,0);let i=new D.OrbitControls(a,t.domElement);i.enablePan=!1,i.enableZoom=!1,i.minPolarAngle=.2,i.maxPolarAngle=Math.PI/2-.1;let y=new r.AmbientLight(16777215,.9);s.add(y);let m=new r.DirectionalLight(16777215,1.2);m.position.set(-12,18,8),m.castShadow=!0,m.shadow.mapSize.set(1024,1024),s.add(m);let h=new r.PlaneGeometry(80,80),p=new r.MeshStandardMaterial({color:3114330,metalness:.2,roughness:.8}),w=new r.Mesh(h,p);w.rotation.x=-Math.PI/2,w.position.y=-1,w.receiveShadow=!0,s.add(w);let g=new O.World({timestep:1/60,iterations:8,broadphase:2,worldscale:1,random:!0,info:!1,gravity:[0,-9.8*3,0]});g.add({type:"box",size:[160,2,160],pos:[0,-2,0],rot:[0,0,0],move:!1,density:1});let v=20;g.add({type:"box",size:[1,30,160],pos:[-v,15,0],rot:[0,0,0],move:!1,density:1}),g.add({type:"box",size:[1,30,160],pos:[v,15,0],rot:[0,0,0],move:!1,density:1}),n.scene=s,n.camera=a,n.renderer=t,n.controls=i,n.world=g;function T(){requestAnimationFrame(T),n.world&&n.world.step(1/60);for(let E of n.diceEntities){let I=E.body.getPosition(),H=E.body.getQuaternion();E.mesh.position.set(I.x,I.y,I.z),E.mesh.quaternion.set(H.x,H.y,H.z,H.w)}i.update(),t.render(s,a)}requestAnimationFrame(T),window.addEventListener("resize",R);function R(){let E=l.clientWidth,I=l.clientHeight;t.setSize(E,I),a.aspect=E/I||1,a.updateProjectionMatrix()}}function b(o,e=256,t="#ffffff"){let s=document.createElement("canvas");s.width=s.height=e;let a=s.getContext("2d");if(!a)return new r.CanvasTexture(s);a.fillStyle=t,a.fillRect(0,0,e,e),a.strokeStyle="#e2e8f0",a.lineWidth=e*.06,a.strokeRect(a.lineWidth/2,a.lineWidth/2,e-a.lineWidth,e-a.lineWidth);let i=e*.08;a.fillStyle="#111827";function y(p,w){let g=[.2,.5,.8][p-1],v=[.2,.5,.8][w-1];a.beginPath(),a.arc(g*e,v*e,i,0,Math.PI*2),a.fill()}let m={1:[[2,2]],2:[[1,1],[3,3]],3:[[1,1],[2,2],[3,3]],4:[[1,1],[3,1],[1,3],[3,3]],5:[[1,1],[3,1],[2,2],[1,3],[3,3]],6:[[1,1],[1,2],[1,3],[3,1],[3,2],[3,3]]};for(let p of m[o]||m[1])y(p[0],p[1]);let h=new r.CanvasTexture(s);return h.anisotropy=8,h.needsUpdate=!0,h}function Y(o){let e={1:b(1,256,o),2:b(2,256,o),3:b(3,256,o),4:b(4,256,o),5:b(5,256,o),6:b(6,256,o)},t=y=>({map:y,roughness:.45,metalness:.05}),s=[new r.MeshStandardMaterial(t(e[3])),new r.MeshStandardMaterial(t(e[4])),new r.MeshStandardMaterial(t(e[1])),new r.MeshStandardMaterial(t(e[6])),new r.MeshStandardMaterial(t(e[2])),new r.MeshStandardMaterial(t(e[5]))],a=new W.RoundedBoxGeometry(2,2,2,6,.24),i=new r.Mesh(a,s);return i.castShadow=!0,i.receiveShadow=!1,i}function Z(o){for(let t of n.diceEntities)n.scene.remove(t.mesh);n.diceEntities=[];let e=[{x:-1.4,y:14,z:0},{x:1.4,y:15,z:0}];for(let t=0;t<2;t++){let s=Y(o);s.position.set(e[t].x,e[t].y,e[t].z),n.scene.add(s);let a=n.world.add({type:"box",size:[2,2,2],pos:[e[t].x,e[t].y,e[t].z],rot:[Math.random()*360,Math.random()*360,Math.random()*360],move:!0,density:2,friction:.5,restitution:.75});n.diceEntities.push({mesh:s,body:a,color:o})}}function _(o){let e=new r.Vector3(0,1,0),t=[{n:new r.Vector3(1,0,0),v:3},{n:new r.Vector3(-1,0,0),v:4},{n:new r.Vector3(0,1,0),v:1},{n:new r.Vector3(0,-1,0),v:6},{n:new r.Vector3(0,0,1),v:2},{n:new r.Vector3(0,0,-1),v:5}],s={dot:-1/0,value:1};for(let a of t){let y=a.n.clone().applyQuaternion(o).dot(e);y>s.dot&&(s={dot:y,value:a.v})}return s.value}function J(){return n.diceEntities.map(o=>{let e=o.body.getQuaternion(),t=new r.Quaternion(e.x,e.y,e.z,e.w);return _(t)})}function M(o){G.textContent=`Amount: ${o||"-"}`;let e=n.players[n.currentPlayerIdx];$.textContent=`Total: ${e.total}`,Q.textContent=n.numPlayers===2?n.currentPlayerIdx===0?"Player 1":"Player 2":"Player",N.className="chip-dot "+(n.currentPlayerIdx===0?"blue":"pink")}function K(o){let e=new Map;for(let a of o)e.set(a,(e.get(a)||0)+1);let t=o[0],s=-1;for(let[a,i]of e)i>s&&(t=a,s=i);return t}async function ee(o=7,e=50){let t=Array.from({length:n.diceEntities.length},()=>[]);for(let s=0;s<o;s++){let a=J();for(let i=0;i<a.length;i++)t[i].push(a[i]);await new Promise(i=>setTimeout(i,e))}return t.map(s=>K(s))}function V(o){let e=o&&o.getLinearVelocity?o.getLinearVelocity():{x:0,y:0,z:0},t=o&&o.getAngularVelocity?o.getAngularVelocity():{x:0,y:0,z:0},s=Math.sqrt((e.x||0)*(e.x||0)+(e.y||0)*(e.y||0)+(e.z||0)*(e.z||0)),a=Math.sqrt((t.x||0)*(t.x||0)+(t.y||0)*(t.y||0)+(t.z||0)*(t.z||0));return{lin:s,ang:a}}function te(o=7e3,e=.1,t=.1,s=30,a=900,i=300){return new Promise(y=>{let m=0,h=performance.now();function p(){let w=performance.now(),g=n.diceEntities.length>0&&n.diceEntities.every(T=>{let R=V(T.body);return R.lin<e&&R.ang<t});w-h>=a&&(g?m++:m=0);let v=w-h>o;m>=s||v?setTimeout(()=>{let T=n.diceEntities.length>0&&n.diceEntities.every(R=>{let E=V(R.body);return E.lin<e&&E.ang<t});y(T)},i):requestAnimationFrame(p)}requestAnimationFrame(p)})}function k(){n.numPlayers===2&&(n.currentPlayerIdx=(n.currentPlayerIdx+1)%2,u(`Turn: ${n.currentPlayerIdx===0?"Player 1":"Player 2"}`),M(0))}function z(){let o=n.players[0],e=n.players[1];if(n.numPlayers===1){o.total>P&&u(`Bust! Over by ${o.total-P}.`);return}if(n.currentPlayerIdx===1&&e.total>=0){let t=o.total<=P?o.total:-1/0,s=e.total<=P?e.total:-1/0;t===s?u("Tie!"):t>s?u("Player 1 wins!"):u("Player 2 wins!")}}async function ne(){if(n.rolling)return;n.rolling=!0,c.disabled=!0,d.disabled=!0;let o=n.players[n.currentPlayerIdx];u("Rolling..."),Z(o.color),await te(7e3,.08,.08,36,1100,350);let e=await ee(9,45),t=(e[0]||0)+(e[1]||0);if(o.total+=t,M(t),o.total===P){u("Exact 101! You win!"),n.rolling=!1,c.disabled=!0,d.disabled=!0;return}if(o.total>P){u(`Bust! Over by ${o.total-P}.`),n.rolling=!1,n.numPlayers===2?n.currentPlayerIdx===0?(k(),c.disabled=!1,d.disabled=!1):(z(),c.disabled=!0,d.disabled=!0):(c.disabled=!0,d.disabled=!0);return}u("Choose: Roll again or Stop."),n.rolling=!1,c.disabled=!1,d.disabled=!1}function oe(){n.rolling||(n.numPlayers===2?n.currentPlayerIdx===0?(k(),c.disabled=!1,d.disabled=!1):(z(),c.disabled=!0,d.disabled=!0):(u("Stopped."),c.disabled=!0,d.disabled=!0))}function ae(){for(let o of n.diceEntities)n.scene.remove(o.mesh);n.diceEntities=[],n.players[0].total=0,n.players[1].total=0,n.currentPlayerIdx=0,n.rolling=!1,M(0),u("Press Start"),c.disabled=!1,d.disabled=!1,B.style.display=""}function A(o){n.numPlayers=o,B.style.display="none",u(`Turn: ${o===2?"Player 1":"Player"}`),M(0)}U.addEventListener("click",()=>A(1)),j.addEventListener("click",()=>A(2)),c.addEventListener("click",ne),d.addEventListener("click",oe),x.addEventListener("click",ae),X(),M(0)})();})();
