"use strict";(()=>{var o=class{constructor(){this.currentPattern=[],this.correctAnswer=0,this.score=0,this.level=1,this.streak=0,this.isPlaying=!1,this.tempo=100,this.gameMode="listen",this.audioContext=null,this.initAudio(),this.initializeElements(),this.attachEventListeners(),this.updateDisplay(),this.switchMode("listen")}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{}}initializeElements(){this.scoreElement=document.getElementById("score"),this.levelElement=document.getElementById("level"),this.streakElement=document.getElementById("streak"),this.rhythmDisplay=document.getElementById("rhythmDisplay"),this.rhythmPattern=document.getElementById("rhythmPattern"),this.tempoSlider=document.getElementById("tempoSlider"),this.tempoValue=document.getElementById("tempoValue"),this.newRhythmBtn=document.getElementById("newRhythmBtn"),this.playBtn=document.getElementById("playBtn"),this.checkBtn=document.getElementById("checkBtn"),this.listenModeBtn=document.getElementById("listenModeBtn"),this.readModeBtn=document.getElementById("readModeBtn"),this.listenMode=document.getElementById("listenMode"),this.readMode=document.getElementById("readMode"),this.notationChoices=document.getElementById("notationChoices"),this.audioChoices=document.getElementById("audioChoices"),this.notationDisplay=document.getElementById("notationDisplay"),this.listenModeInstructions=document.getElementById("listenModeInstructions"),this.readModeInstructions=document.getElementById("readModeInstructions")}attachEventListeners(){this.newRhythmBtn.addEventListener("click",()=>this.generateNewRhythm()),this.playBtn.addEventListener("click",()=>this.playCurrentRhythm()),this.checkBtn.addEventListener("click",()=>this.checkAnswer()),this.listenModeBtn.addEventListener("click",()=>this.switchMode("listen")),this.readModeBtn.addEventListener("click",()=>this.switchMode("read")),this.tempoSlider.addEventListener("input",t=>{this.tempo=parseInt(t.target.value),this.tempoValue.textContent=this.tempo})}switchMode(t){this.gameMode=t,this.listenModeBtn.classList.toggle("active",t==="listen"),this.readModeBtn.classList.toggle("active",t==="read"),this.listenMode.style.display=t==="listen"?"block":"none",this.readMode.style.display=t==="read"?"block":"none",this.listenModeInstructions.style.display=t==="listen"?"block":"none",this.readModeInstructions.style.display=t==="read"?"block":"none",this.resetGame(),this.rhythmDisplay.textContent=`${t==="listen"?"Listen Mode":"Read Mode"}: Press "New Rhythm" to start!`}resetGame(){this.currentPattern=[],this.correctAnswer=0,this.notationChoices.style.display="none",this.audioChoices.style.display="none",this.notationDisplay.textContent="",this.playBtn.disabled=!0,this.checkBtn.disabled=!0,this.clearChoiceSelection()}generateNewRhythm(){this.resetGame(),this.currentPattern=[];let t=[0,1,2];for(let i=0;i<4;i++)this.currentPattern.push(t[Math.floor(Math.random()*t.length)]);this.currentPattern.filter(i=>i!==0).length<2&&(this.currentPattern[0]=1,this.currentPattern[2]=1),this.gameMode==="listen"?this.startListenMode():this.startReadMode(),this.playBtn.disabled=!1,this.checkBtn.disabled=!1}startListenMode(){this.rhythmDisplay.textContent="Listen to the rhythm...",this.playCurrentRhythm(),setTimeout(()=>{this.generateNotationChoices()},1e3)}startReadMode(){this.displayNotation(),this.generateAudioChoices(),this.rhythmDisplay.textContent="Study the notation, then choose the matching audio"}generateNotationChoices(){let t=[];t.push({notation:this.patternToNotation(this.currentPattern),pattern:[...this.currentPattern],isCorrect:!0});for(let e=0;e<3;e++){let i;do i=this.generateRandomPattern();while(this.patternsEqual(i,this.currentPattern));t.push({notation:this.patternToNotation(i),pattern:i,isCorrect:!1})}this.shuffleArray(t),this.correctAnswer=t.findIndex(e=>e.isCorrect),this.displayNotationChoices(t),this.notationChoices.style.display="grid"}generateAudioChoices(){let t=[];t.push({pattern:[...this.currentPattern],isCorrect:!0,label:"Option A"});for(let e=0;e<3;e++){let i;do i=this.generateRandomPattern();while(this.patternsEqual(i,this.currentPattern));t.push({pattern:i,isCorrect:!1,label:`Option ${String.fromCharCode(66+e)}`})}this.shuffleArray(t),this.correctAnswer=t.findIndex(e=>e.isCorrect),this.currentAudioChoices=t,this.displayAudioChoices(t),this.audioChoices.style.display="grid"}displayNotation(){this.notationDisplay.textContent=this.patternToNotation(this.currentPattern)}displayNotationChoices(t){this.notationChoices.innerHTML="",t.forEach((e,i)=>{let s=document.createElement("div");s.className="choice-button",s.dataset.choice=i,s.innerHTML=`<div style="font-size: 1.5em; margin-bottom: 10px;">${e.notation}</div>`,s.addEventListener("click",()=>this.selectChoice(i)),this.notationChoices.appendChild(s)})}displayAudioChoices(t){this.audioChoices.innerHTML="",t.forEach((e,i)=>{let s=document.createElement("div");s.className="choice-button",s.dataset.choice=i,s.innerHTML=`
                        <div style="font-size: 1.2em; margin-bottom: 10px;">${e.label}</div>
                        <button onclick="event.stopPropagation(); game.playPattern(${i})" class="btn secondary" style="font-size: 0.8em;">\u{1F50A} Play</button>
                    `,s.addEventListener("click",()=>this.selectChoice(i)),this.audioChoices.appendChild(s)})}async playPattern(t){this.gameMode!=="read"||!this.currentAudioChoices||this.currentAudioChoices[t]&&await this.playRhythmPattern(this.currentAudioChoices[t].pattern)}selectChoice(t){this.clearChoiceSelection();let i=(this.gameMode==="listen"?this.notationChoices:this.audioChoices).querySelector(`[data-choice="${t}"]`);i&&(i.classList.add("selected"),this.selectedChoice=t)}clearChoiceSelection(){document.querySelectorAll(".choice-button").forEach(t=>{t.classList.remove("selected","correct","incorrect")}),this.selectedChoice=null}patternToNotation(t){let e="";for(let i of t)switch(i){case 0:e+="\u{1D13D} ";break;case 1:e+="\u2669 ";break;case 2:e+="\u266B ";break}return e.trim()}generateRandomPattern(){let t=[],e=[0,1,2];for(let s=0;s<4;s++)t.push(e[Math.floor(Math.random()*e.length)]);return t.filter(s=>s!==0).length<2&&(t[0]=1,t[2]=1),t}patternsEqual(t,e){return t.length===e.length&&t.every((i,s)=>i===e[s])}shuffleArray(t){for(let e=t.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}async playCurrentRhythm(){await this.playRhythmPattern(this.currentPattern)}async playRhythmPattern(t){if(!this.audioContext||this.isPlaying)return;this.isPlaying=!0;let e=this.rhythmDisplay.textContent;this.rhythmDisplay.textContent="Playing rhythm... \u{1F3B5}";let i=6e4/this.tempo;for(let s=0;s<t.length;s++){let n=t[s];n===1?this.playBeep(440,.2):n===2&&(this.playBeep(440,.1),setTimeout(()=>this.playBeep(440,.1),i/2)),await this.sleep(i)}this.isPlaying=!1,this.rhythmDisplay.textContent=e}playBeep(t,e){if(!this.audioContext)return;let i=this.audioContext.createOscillator(),s=this.audioContext.createGain();i.connect(s),s.connect(this.audioContext.destination),i.frequency.setValueAtTime(t,this.audioContext.currentTime),i.type="sine",s.gain.setValueAtTime(.3,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+e),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+e)}sleep(t){return new Promise(e=>setTimeout(e,t))}checkAnswer(){if(this.selectedChoice===null){this.rhythmDisplay.textContent="Please select an answer first!";return}let t=this.selectedChoice===this.correctAnswer;this.showResults(t),t?(this.score+=10+this.level*5,this.streak++,this.streak%5===0&&(this.level++,this.rhythmDisplay.textContent=`\u{1F389} Level Up! Now level ${this.level}!`)):this.streak=0,this.updateDisplay(),setTimeout(()=>{this.resetGame(),this.rhythmDisplay.textContent="Ready for next rhythm!"},3e3)}showResults(t){(this.gameMode==="listen"?this.notationChoices:this.audioChoices).querySelectorAll(".choice-button").forEach((s,n)=>{n===this.correctAnswer?s.classList.add("correct"):n===this.selectedChoice&&!t&&s.classList.add("incorrect")}),t?this.rhythmDisplay.textContent="\u{1F389} Correct! Great rhythm recognition!":this.rhythmDisplay.textContent="\u274C Not quite right. The correct answer is highlighted in green."}updateDisplay(){this.scoreElement.textContent=this.score,this.levelElement.textContent=this.level,this.streakElement.textContent=this.streak}},a;document.addEventListener("DOMContentLoaded",()=>{a=new o});})();
