(()=>{(function(){let g=document.getElementById("items"),l=document.getElementById("receipt"),L=document.getElementById("notes"),y=document.getElementById("coins"),C=document.getElementById("cashSlot"),M=document.getElementById("chips"),h=document.getElementById("status"),T=document.getElementById("finishBtn"),m=document.getElementById("padDisplay"),B=document.getElementById("helpBtn"),f=document.getElementById("hintMsg"),u=document.getElementById("discountsList"),E=[],H=null,s=0,a=0,p=[],$=0,d=[],N=[50,20,10,5],k=[2,1,.5,.2,.1,.05,.01],A=[{name:"Milk",price:1.2,barcode:"M-001"},{name:"Bread",price:.9,barcode:"B-002"},{name:"Eggs",price:1.8,barcode:"E-003"},{name:"Apples",price:1.1,barcode:"A-004"},{name:"Pasta",price:1.5,barcode:"P-005"},{name:"Juice",price:1.3,barcode:"J-006"},{name:"Cereal",price:2.7,barcode:"C-007"},{name:"Cheese",price:2.1,barcode:"C-008"},{name:"Yogurt",price:.8,barcode:"Y-009"}];function i(e){return e.toFixed(2)}function w(){E=[],s=0,a=0,H=null,l.innerHTML="",f.textContent="",d=[],u&&(u.innerHTML='<div class="discount">No discounts</div>')}function S(){let e=Math.floor(Math.random()*3)+3,t=[...A],n=[];for(let o=0;o<e;o++){let r=t.splice(Math.floor(Math.random()*t.length),1)[0];n.push(r)}g.innerHTML="",n.forEach(o=>{let r=document.createElement("div");r.className="item",r.innerHTML=`<div>${o.name}</div><div class="price">\xA3${i(o.price)}</div><div class="barcode">${o.barcode}</div>`,r.addEventListener("click",()=>O(o)),g.appendChild(r)}),d=[];let c=()=>Math.floor(Math.random()*n.length);if(n.length>0){let o=n[c()].name,r=[10,15,20][Math.floor(Math.random()*3)];d.push({type:"percent",item:o,percent:r})}if(n.length>1&&Math.random()<.6){let o=n[c()].name,r=0;for(;d.some(J=>J.item===o)&&r++<5;)o=n[c()].name;let Y=[.1,.2,.5][Math.floor(Math.random()*3)];d.push({type:"amount",item:o,amount:Y})}D()}function D(){if(u.innerHTML="",d.length===0){u.innerHTML='<div class="discount">No discounts</div>';return}d.forEach(e=>{let t=document.createElement("div");t.className="discount",e.type==="percent"?t.textContent=`${e.item}: ${e.percent}% off`:t.textContent=`${e.item}: \xA3${i(e.amount)} off`,u.appendChild(t)})}function v(e){let t=0,n="";return d.forEach(c=>{if(c.item===e.name){if(c.type==="percent"){let o=Math.round(e.price*(c.percent/100)*100)/100;o>t&&(t=o,n=`${c.percent}% off`)}else if(c.type==="amount"){let o=Math.min(c.amount,e.price);o>t&&(t=o,n=`\xA3${i(o)} off`)}}}),{amount:t,label:n}}function O(e){E.push(e);let t=document.createElement("div");t.className="receipt-line",t.innerHTML=`<span>${e.name}</span><span>\xA3${i(e.price)}</span>`,l.appendChild(t),s=Math.round((s+e.price)*100)/100;let n=v(e);if(n.amount>0){let c=document.createElement("div");c.className="receipt-line",c.innerHTML=`<span>\u2014 Discount (${n.label})</span><span>-\xA3${i(n.amount)}</span>`,l.appendChild(c),s=Math.round((s-n.amount)*100)/100}h.textContent="Added "+e.name+" to receipt"}function F(){L.innerHTML="",y.innerHTML="",N.forEach(e=>{let t=document.createElement("button");t.className="note",t.textContent="\xA3"+e,t.addEventListener("click",()=>b(e)),L.appendChild(t)}),k.forEach(e=>{let t=document.createElement("button");t.className="coin",t.textContent="\xA3"+i(e),t.addEventListener("click",()=>b(e)),y.appendChild(t)})}function b(e){a=Math.round((a+e)*100)/100,p.push(e),C.textContent="Inserted: \xA3"+i(a),x()}function x(){if(M.innerHTML="",p.length===0){M.innerHTML='<div style="opacity:0.7;">\u2014</div>';return}p.forEach((e,t)=>{let n=document.createElement("button");n.className="chip",n.textContent="\xA3"+i(e),n.title="Remove this",n.addEventListener("click",()=>G(t)),M.appendChild(n)})}function G(e){let t=p[e];p.splice(e,1),a=Math.round((a-t)*100)/100,C.textContent="Inserted: \xA3"+i(a),x()}function V(){s=0,l.innerHTML="",E.forEach(e=>{let t=document.createElement("div");t.className="receipt-line",t.innerHTML=`<span>${e.name}</span><span>\xA3${i(e.price)}</span>`,l.appendChild(t),s=Math.round((s+e.price)*100)/100;let n=v(e);if(n.amount>0){let c=document.createElement("div");c.className="receipt-line",c.innerHTML=`<span>\u2014 Discount (${n.label})</span><span>-\xA3${i(n.amount)}</span>`,l.appendChild(c),s=Math.round((s-n.amount)*100)/100}})}function P(){if(E.length===0){f.textContent="Add items first.";return}let e=Math.round(s*100)/100;a<e?f.textContent=`You need \xA3${i(e-a)} more.`:f.textContent=`Change should be \xA3${i(a-e)}.`}function R(){let e=Math.round(s*100)/100,t=Math.round((a-e)*100)/100,n=`Subtotal \xA3${i(e)}. `;a<e?n+=`Short by \xA3${i(e-a)}.`:a===e?n+="Exact payment. Great job!":n+=`Change due \xA3${i(t)}.`;let c=Math.round((performance.now()-$)/1e3),o=3;a<e?o=1:c>45&&(o=2),a===e?(h.textContent=`\u{1F389} CONGRATULATIONS! ${n} \u23F1\uFE0F ${c}s \u2B50 ${"\u2605".repeat(o)}${"\u2606".repeat(3-o)}`,setTimeout(()=>I(),1200)):h.textContent=`${n} \u23F1\uFE0F ${c}s \u2B50 ${"\u2605".repeat(o)}${"\u2606".repeat(3-o)}`}function I(){w(),S(),F(),C.textContent="Insert payment here",h.textContent="New order loaded. Click items to add, then Evaluate.",$=performance.now()}function U(){R()}(function(){let t="";m.textContent="0.00",document.querySelectorAll(".pad-btn").forEach(n=>{n.addEventListener("click",()=>{let c=n.textContent.trim();if(c==="C"){t="",m.textContent="0.00";return}if(c==="="){try{let o=Function("return "+t)();m.textContent=isFinite(o)?String(o):"Err"}catch{m.textContent="Err"}return}c==="+"||c==="-"?t+=" "+c+" ":t+=c,m.textContent=t})})})(),T.addEventListener("click",U),B.addEventListener("click",P),I()})();})();
