(()=>{var r=class{constructor(){this.notes=[{name:"C",solfege:"Do",position:"below",offset:10,octave:4},{name:"C#",solfege:"Di",position:"below",offset:5,octave:4},{name:"D",solfege:"Re",position:"line-4",offset:0,octave:4},{name:"D#",solfege:"Ri",position:"line-4",offset:-5,octave:4},{name:"E",solfege:"Mi",position:"space-3",offset:-10,octave:4},{name:"F",solfege:"Fa",position:"line-3",offset:-20,octave:4},{name:"F#",solfege:"Fi",position:"line-3",offset:-25,octave:4},{name:"G",solfege:"Sol",position:"space-2",offset:-30,octave:4},{name:"G#",solfege:"Si",position:"space-2",offset:-35,octave:4},{name:"A",solfege:"La",position:"line-2",offset:-40,octave:4},{name:"A#",solfege:"Li",position:"line-2",offset:-45,octave:4},{name:"B",solfege:"Ti",position:"space-1",offset:-50,octave:4},{name:"C",solfege:"Do",position:"line-1",offset:-60,octave:5},{name:"C#",solfege:"Di",position:"space-above",offset:-70,octave:5}],this.currentSequence=[],this.userSequence=[],this.score=0,this.level=1,this.streak=0,this.audioContext=null,this.initAudio(),this.initializeElements(),this.createStaff(),this.createKeyboard(),this.attachEventListeners(),this.updateDisplay()}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{}}initializeElements(){this.scoreElement=document.getElementById("score"),this.levelElement=document.getElementById("level"),this.streakElement=document.getElementById("streak"),this.staffElement=document.getElementById("staff"),this.userSequenceElement=document.getElementById("userSequence"),this.keyboardElement=document.getElementById("keyboard"),this.newSequenceBtn=document.getElementById("newSequenceBtn"),this.playBtn=document.getElementById("playBtn"),this.checkBtn=document.getElementById("checkBtn"),this.clearBtn=document.getElementById("clearBtn")}createStaff(){this.staffElement.innerHTML="";for(let t=0;t<5;t++){let n=document.createElement("div");n.className="staff-line",n.style.top=`${40+t*30}px`,this.staffElement.appendChild(n)}let e=document.createElement("div");e.className="clef",e.textContent="\u{1D11E}",this.staffElement.appendChild(e)}createKeyboard(){this.keyboardElement.innerHTML="";let e=["C","D","E","F","G","A","B"],t=[0,1,3,4,5],n=["C#","D#","F#","G#","A#"];e.forEach((i,o)=>{let s=document.createElement("div");s.className="key white-key",s.dataset.note=i,s.textContent=i,s.addEventListener("click",()=>this.handleKeyClick(i)),this.keyboardElement.appendChild(s)}),n.forEach((i,o)=>{let s=document.createElement("div");s.className="key black-key",s.dataset.note=i,s.textContent=i;let c=52,a=t[o];s.style.left=`${(a+1)*c}px`,s.addEventListener("click",()=>this.handleKeyClick(i)),this.keyboardElement.appendChild(s)})}attachEventListeners(){this.newSequenceBtn.addEventListener("click",()=>this.generateNewSequence()),this.playBtn.addEventListener("click",()=>this.playSequence()),this.checkBtn.addEventListener("click",()=>this.checkAnswer()),this.clearBtn.addEventListener("click",()=>this.clearUserInput())}generateNewSequence(){this.currentSequence=[],this.userSequence=[],this.clearStaffNotes(),this.clearUserInput();for(let e=0;e<6;e++){let t=this.notes[Math.floor(Math.random()*this.notes.length)];this.currentSequence.push(t)}this.displayNotesOnStaff(),this.playBtn.disabled=!1,this.checkBtn.disabled=!1}displayNotesOnStaff(){this.clearStaffNotes(),this.currentSequence.forEach((e,t)=>{let n=document.createElement("div");n.className="note",n.textContent="\u2669",n.style.left=`${120+t*80}px`,n.style.top=`${70+e.offset}px`,this.staffElement.appendChild(n)})}clearStaffNotes(){this.staffElement.querySelectorAll(".note").forEach(t=>t.remove())}handleKeyClick(e){let t=this.notes.filter(o=>o.name===e);if(t.length===0)return;let n=t[0];if(t.length>1&&this.currentSequence.length>0){let o=this.userSequence.length;if(o<this.currentSequence.length){let s=this.currentSequence[o],c=t.find(a=>a.name===s.name&&(a.octave||4)===(s.octave||4));c&&(n=c)}}this.userSequence.push(n),this.updateUserSequenceDisplay();let i=document.querySelector(`[data-note="${e}"]`);i.classList.add("active"),setTimeout(()=>i.classList.remove("active"),200),this.playNote(n)}updateUserSequenceDisplay(){let e=this.userSequence.map(t=>`${t.name}${t.octave||4} (${t.solfege})`).join(" \u2192 ");this.userSequenceElement.textContent=e||"Your sequence will appear here..."}clearUserInput(){this.userSequence=[],this.updateUserSequenceDisplay(),document.querySelectorAll(".key").forEach(e=>{e.classList.remove("correct","incorrect","active")})}async playSequence(){if(this.audioContext)for(let e=0;e<this.currentSequence.length;e++)this.playNote(this.currentSequence[e]),await this.sleep(600)}playNote(e){if(!this.audioContext)return;let n={C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.23,"F#":369.99,G:392,"G#":415.3,A:440,"A#":466.16,B:493.88}[e.name];if(!n)return;let i=Math.pow(2,(e.octave||4)-4),o=n*i,s=this.audioContext.createOscillator(),c=this.audioContext.createGain();s.connect(c),c.connect(this.audioContext.destination),s.frequency.setValueAtTime(o,this.audioContext.currentTime),s.type="sine",c.gain.setValueAtTime(.3,this.audioContext.currentTime),c.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+.5)}sleep(e){return new Promise(t=>setTimeout(t,e))}checkAnswer(){if(this.userSequence.length===0){this.userSequenceElement.textContent="Please play some notes first!";return}let e=this.sequencesMatch();this.showResults(e),e?(this.score+=15+this.level*5,this.streak++,this.streak%3===0&&this.level++):this.streak=0,this.updateDisplay(),setTimeout(()=>{this.clearUserInput(),this.playBtn.disabled=!0,this.checkBtn.disabled=!0},3e3)}sequencesMatch(){if(this.userSequence.length!==this.currentSequence.length)return!1;for(let e=0;e<this.currentSequence.length;e++){let t=this.userSequence[e],n=this.currentSequence[e];if(t.name!==n.name||(t.octave||4)!==(n.octave||4))return!1}return!0}showResults(e){if(this.currentSequence.forEach((t,n)=>{let i=document.querySelector(`[data-note="${t.name}"]`),o=this.userSequence[n];o&&o.name===t.name?i.classList.add("correct"):i.classList.add("incorrect")}),e)this.userSequenceElement.innerHTML="\u{1F389} Perfect! You read the notes correctly!";else{let t=this.currentSequence.map(n=>`${n.name}${n.octave||4} (${n.solfege})`).join(" \u2192 ");this.userSequenceElement.innerHTML=`\u274C Not quite right.<br>Correct sequence: ${t}`}}updateDisplay(){this.scoreElement.textContent=this.score,this.levelElement.textContent=this.level,this.streakElement.textContent=this.streak}};document.addEventListener("DOMContentLoaded",()=>{new r});})();
