require 'jekyll'

desc "Build the Jekyll site"
task :build do
  puts "Building Jekyll site..."
  system("bundle exec jekyll build")
end

desc "Serve the Jekyll site locally on port 4000"
task :serve do
  puts "Starting Jekyll development server on http://localhost:4000"
  puts "Press Ctrl+C to stop the server"
  system("bundle exec jekyll serve --port 4000")
end

desc "Serve the Jekyll site on a custom port"
task :serve_port, [:port] do |t, args|
  port = args[:port] || "4000"
  puts "Starting Jekyll development server on http://localhost:#{port}"
  puts "Press Ctrl+C to stop the server"
  system("bundle exec jekyll serve --port #{port}")
end

desc "Clean the Jekyll build"
task :clean do
  puts "Cleaning Jekyll build..."
  system("bundle exec jekyll clean")
end

desc "Open the website in default browser"
task :open do
  system("open http://localhost:4000")
end

desc "Build and serve the Jekyll site"
task :start do
  Rake::Task[:build].invoke
  Rake::Task[:serve].invoke
end

desc "Deploy to GitHub Pages (build and push)"
task :deploy do
  puts "Building site for deployment..."
  system("bundle exec jekyll build")
  puts "Site built successfully!"
  puts "Commit and push the changes to deploy to GitHub Pages"
end

# Set serve as the default task
task :default => :serve

desc "Serve with livereload (requires EventMachine)"
task :serve_livereload do
  puts "Starting Jekyll development server with livereload on http://localhost:4000"
  puts "Press Ctrl+C to stop the server"
  system("bundle exec jekyll serve --port 4000 --livereload")
end

desc "Show available tasks"
task :help do
  puts "Available Jekyll tasks:"
  puts "  rake serve (default)    - Start Jekyll dev server on port 4000"
  puts "  rake serve_livereload   - Start server with livereload (may need EventMachine)"
  puts "  rake serve_port[PORT]   - Start server on custom port"
  puts "  rake build             - Build the Jekyll site"
  puts "  rake clean             - Clean Jekyll build files"
  puts "  rake start             - Build and serve"
  puts "  rake deploy            - Build for deployment"
  puts "  rake open              - Open website in browser"
  puts "  rake help              - Show this help message"
  puts ""
  puts "Note: Default 'serve' command avoids EventMachine issues"
end