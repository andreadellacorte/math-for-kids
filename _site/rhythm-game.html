<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhythm Game - Music Trivia</title>
    <link rel="stylesheet" href="/styles.css">
    
    
        <style>.rhythm-container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
    padding: 20px;
}

.rhythm-display {
    background: #f8f9fa;
    border: 3px solid #007bff;
    border-radius: 15px;
    padding: 30px;
    margin: 20px 0;
    min-height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3em;
}

.beat-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin: 20px 0;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.beat-button {
    width: 80px;
    height: 80px;
    border: 3px solid #007bff;
    border-radius: 15px;
    background: #fff;
    font-size: 1.5em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.beat-button:hover {
    background: #e7f3ff;
    transform: scale(1.05);
}

.beat-button.active {
    background: #007bff;
    color: white;
    transform: scale(0.95);
}

.beat-button.correct {
    background: #28a745;
    color: white;
    border-color: #28a745;
}

.beat-button.incorrect {
    background: #dc3545;
    color: white;
    border-color: #dc3545;
}

.rhythm-pattern {
    font-family: 'Courier New', monospace;
    font-size: 1.5em;
    margin: 10px 0;
    padding: 15px;
    background: #fff;
    border: 2px solid #dee2e6;
    border-radius: 10px;
}

.controls {
    margin: 20px 0;
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.game-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin: 20px 0;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.stat-card {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    border: 2px solid #dee2e6;
}

.stat-value {
    font-size: 2em;
    font-weight: bold;
    color: #007bff;
}

.beat-number {
    position: absolute;
    top: -10px;
    left: -10px;
    background: #6c757d;
    color: white;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
}

.tempo-slider {
    margin: 20px 0;
}

.tempo-slider input {
    width: 200px;
}

@media (max-width: 768px) {
    .beat-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 200px;
    }

    .beat-button {
        width: 60px;
        height: 60px;
        font-size: 1.2em;
    }
}
</style>
    
</head>
<body>
        <div class="container">
        <div class="header">
            <a href="music-trivia.html" class="back-btn">‚Üê Back to Music Trivia</a>
            <h1>ü•Å Rhythm Game</h1>
        </div>

        <div class="rhythm-container">
            <p class="subtitle">Listen to the rhythm and tap it back!</p>

            <div class="game-stats">
                <div class="stat-card">
                    <div class="stat-value" id="score">0</div>
                    <div>Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">1</div>
                    <div>Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streak">0</div>
                    <div>Streak</div>
                </div>
            </div>

            <div class="rhythm-display" id="rhythmDisplay">
                Press "New Rhythm" to start!
            </div>

            <div class="rhythm-pattern" id="rhythmPattern"></div>

            <div class="tempo-slider">
                <label for="tempoSlider">Tempo: </label>
                <input type="range" id="tempoSlider" min="60" max="150" value="120">
                <span id="tempoValue">120</span> BPM
            </div>

            <div class="controls">
                <button class="btn" id="newRhythmBtn">New Rhythm</button>
                <button class="btn secondary" id="playBtn" disabled>Play Again</button>
                <button class="btn secondary" id="checkBtn" disabled>Check Answer</button>
                <button class="btn secondary" id="clearBtn">Clear</button>
            </div>

            <div class="beat-grid" id="beatGrid">
                <div class="beat-button" data-beat="1">
                    <div class="beat-number">1</div>
                    <span>‚ô©</span>
                </div>
                <div class="beat-button" data-beat="2">
                    <div class="beat-number">2</div>
                    <span>‚ô©</span>
                </div>
                <div class="beat-button" data-beat="3">
                    <div class="beat-number">3</div>
                    <span>‚ô©</span>
                </div>
                <div class="beat-button" data-beat="4">
                    <div class="beat-number">4</div>
                    <span>‚ô©</span>
                </div>
            </div>

            <div class="info-box" style="margin-top: 30px;">
                <h3>How to Play:</h3>
                <p>1. Click "New Rhythm" to generate a random 4-beat pattern</p>
                <p>2. Listen carefully to the rhythm</p>
                <p>3. Click the numbered buttons in the order you heard the beats</p>
                <p>4. Use "Play Again" to replay the rhythm if needed</p>
                <p>5. Click "Check Answer" when you're ready to submit</p>
            </div>
        </div>
    </div>

    <script>
        class RhythmGame {
            constructor() {
                this.currentPattern = [];
                this.userPattern = [];
                this.score = 0;
                this.level = 1;
                this.streak = 0;
                this.isPlaying = false;
                this.tempo = 120; // BPM

                // Audio context for generating beats
                this.audioContext = null;
                this.initAudio();

                this.initializeElements();
                this.attachEventListeners();
                this.updateDisplay();
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.warn('Audio context not available:', error);
                }
            }

            initializeElements() {
                this.scoreElement = document.getElementById('score');
                this.levelElement = document.getElementById('level');
                this.streakElement = document.getElementById('streak');
                this.rhythmDisplay = document.getElementById('rhythmDisplay');
                this.rhythmPattern = document.getElementById('rhythmPattern');
                this.beatGrid = document.getElementById('beatGrid');
                this.tempoSlider = document.getElementById('tempoSlider');
                this.tempoValue = document.getElementById('tempoValue');

                this.newRhythmBtn = document.getElementById('newRhythmBtn');
                this.playBtn = document.getElementById('playBtn');
                this.checkBtn = document.getElementById('checkBtn');
                this.clearBtn = document.getElementById('clearBtn');
            }

            attachEventListeners() {
                this.newRhythmBtn.addEventListener('click', () => this.generateNewRhythm());
                this.playBtn.addEventListener('click', () => this.playCurrentRhythm());
                this.checkBtn.addEventListener('click', () => this.checkAnswer());
                this.clearBtn.addEventListener('click', () => this.clearUserInput());

                this.tempoSlider.addEventListener('input', (e) => {
                    this.tempo = parseInt(e.target.value);
                    this.tempoValue.textContent = this.tempo;
                });

                // Add beat button listeners
                this.beatGrid.addEventListener('click', (e) => {
                    if (e.target.classList.contains('beat-button')) {
                        this.handleBeatClick(e.target);
                    }
                });
            }

            generateNewRhythm() {
                // Reset game state
                this.currentPattern = [];
                this.userPattern = [];
                this.clearUserInput();

                // Generate a 4-beat pattern
                // Each beat can be: quarter note (1), eighth notes (2), or rest (0)
                const beatTypes = [0, 1, 2]; // 0=rest, 1=quarter, 2=eighth notes

                for (let i = 0; i < 4; i++) {
                    this.currentPattern.push(beatTypes[Math.floor(Math.random() * beatTypes.length)]);
                }

                // Ensure at least 2 beats are not rests
                const nonRestBeats = this.currentPattern.filter(beat => beat !== 0).length;
                if (nonRestBeats < 2) {
                    this.currentPattern[0] = 1;
                    this.currentPattern[2] = 1;
                }

                this.displayPattern();
                this.playCurrentRhythm();

                this.playBtn.disabled = false;
                this.checkBtn.disabled = false;
            }

            displayPattern() {
                let patternText = '';
                for (let i = 0; i < this.currentPattern.length; i++) {
                    switch (this.currentPattern[i]) {
                        case 0:
                            patternText += 'ùÑΩ '; // Rest
                            break;
                        case 1:
                            patternText += '‚ô© '; // Quarter note
                            break;
                        case 2:
                            patternText += '‚ô´ '; // Eighth notes
                            break;
                    }
                }
                this.rhythmPattern.textContent = `Pattern: ${patternText}`;
                this.rhythmDisplay.textContent = 'Listen to the rhythm...';
            }

            async playCurrentRhythm() {
                if (!this.audioContext || this.isPlaying) return;

                this.isPlaying = true;
                this.rhythmDisplay.textContent = 'Playing rhythm... üéµ';

                const beatDuration = 60000 / this.tempo; // milliseconds per beat

                for (let i = 0; i < this.currentPattern.length; i++) {
                    const beatType = this.currentPattern[i];

                    if (beatType === 1) {
                        // Quarter note
                        this.playBeep(440, 0.2);
                    } else if (beatType === 2) {
                        // Two eighth notes
                        this.playBeep(440, 0.1);
                        setTimeout(() => this.playBeep(440, 0.1), beatDuration / 2);
                    }
                    // Rest (0) - no sound

                    await this.sleep(beatDuration);
                }

                this.isPlaying = false;
                this.rhythmDisplay.textContent = 'Now tap the rhythm back!';
            }

            playBeep(frequency, duration) {
                if (!this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            handleBeatClick(button) {
                if (this.isPlaying) return;

                const beatNumber = parseInt(button.dataset.beat);

                // Add to user pattern
                this.userPattern.push(beatNumber);

                // Visual feedback
                button.classList.add('active');
                setTimeout(() => button.classList.remove('active'), 200);

                // Update display
                this.rhythmDisplay.textContent = `Tapped: ${this.userPattern.join(', ')}`;

                // Play feedback sound
                this.playBeep(660, 0.1);
            }

            clearUserInput() {
                this.userPattern = [];
                this.rhythmDisplay.textContent = 'Ready to tap!';

                // Remove all visual feedback
                document.querySelectorAll('.beat-button').forEach(btn => {
                    btn.classList.remove('correct', 'incorrect', 'active');
                });
            }

            checkAnswer() {
                if (this.userPattern.length === 0) {
                    this.rhythmDisplay.textContent = 'Please tap some beats first!';
                    return;
                }

                // Convert pattern to expected user input
                const expectedBeats = [];
                for (let i = 0; i < this.currentPattern.length; i++) {
                    if (this.currentPattern[i] === 1) {
                        expectedBeats.push(i + 1); // Beat numbers are 1-indexed
                    } else if (this.currentPattern[i] === 2) {
                        expectedBeats.push(i + 1); // For eighth notes, still count as one beat press
                    }
                }

                // Check if user input matches expected beats
                const isCorrect = this.arraysEqual(this.userPattern.sort(), expectedBeats.sort());

                this.showResults(isCorrect, expectedBeats);

                if (isCorrect) {
                    this.score += 10 + (this.level * 5);
                    this.streak++;

                    if (this.streak % 5 === 0) {
                        this.level++;
                        this.rhythmDisplay.textContent = `üéâ Level Up! Now level ${this.level}!`;
                    }
                } else {
                    this.streak = 0;
                }

                this.updateDisplay();

                // Reset for next round
                setTimeout(() => {
                    this.clearUserInput();
                    this.playBtn.disabled = true;
                    this.checkBtn.disabled = true;
                }, 2000);
            }

            showResults(isCorrect, expectedBeats) {
                const buttons = document.querySelectorAll('.beat-button');

                buttons.forEach((btn, index) => {
                    const beatNumber = index + 1;
                    const wasExpected = expectedBeats.includes(beatNumber);
                    const wasClicked = this.userPattern.includes(beatNumber);

                    if (wasExpected && wasClicked) {
                        btn.classList.add('correct');
                    } else if (wasClicked && !wasExpected) {
                        btn.classList.add('incorrect');
                    } else if (wasExpected && !wasClicked) {
                        btn.classList.add('incorrect');
                        btn.style.opacity = '0.5';
                    }
                });

                if (isCorrect) {
                    this.rhythmDisplay.textContent = 'üéâ Correct! Great rhythm!';
                } else {
                    this.rhythmDisplay.textContent = `‚ùå Not quite right. Expected beats: ${expectedBeats.join(', ')}`;
                }
            }

            arraysEqual(a, b) {
                return a.length === b.length && a.every((val, i) => val === b[i]);
            }

            updateDisplay() {
                this.scoreElement.textContent = this.score;
                this.levelElement.textContent = this.level;
                this.streakElement.textContent = this.streak;
            }
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new RhythmGame();
        });
    </script>

    </div>
    <div class="footer">
    <div class="footer-content">
        <p class="footer-message">Have fun learning math! üåü</p>
        <div class="footer-links">
            <div class="footer-item">
                <span>Made with ‚ù§Ô∏è by</span>
                <span class="creators">Andrea & Defne</span>
            </div>
            <div class="footer-separator">‚Ä¢</div>
            
            <div class="footer-item">
                <a href="/changelog.html" class="changelog-link">
                    <span>üìù</span>
                    Changelog
                </a>
            </div>
            <div class="footer-separator">‚Ä¢</div>
            
            <div class="footer-item">
                <a href="mailto:andrea@techinterview.coach" class="email-link">
                    <span class="email-icon">üìß</span>
                    Contact
                </a>
            </div>
            <div class="footer-separator">‚Ä¢</div>
            <div class="footer-item">
                <a href="https://github.com/andreadellacorte/math-for-kids" target="_blank" class="github-link">
                    <i class="fab fa-github github-icon"></i>
                    GitHub
                </a>
            </div>
        </div>
    </div>
</div>
    <div class="visit-counter">
    <a href='http://www.freevisitorcounters.com'>freevisitorcounters.com</a>
    <script type='text/javascript' src='https://www.freevisitorcounters.com/auth.php?id=b1a1886d259ff7d2d67be873ee14dcdda1cdba46'></script>
    <script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1397853/t/2"></script>
</div>
</body>
</html>