---
title: "Rhythm Game - Music Trivia"
custom_css: |
        .rhythm-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 20px;
        }

        .rhythm-display {
            background: #f8f9fa;
            border: 3px solid #007bff;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .beat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .choice-button {
            padding: 20px;
            border: 3px solid #007bff;
            border-radius: 15px;
            background: #fff;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .choice-button:hover {
            background: #e7f3ff;
            transform: scale(1.02);
        }

        .choice-button.selected {
            background: #007bff;
            color: white;
        }

        .choice-button.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .choice-button.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .mode-selector {
            margin: 20px 0;
            text-align: center;
        }

        .mode-button {
            margin: 0 10px;
            padding: 10px 20px;
            border: 2px solid #007bff;
            background: #fff;
            color: #007bff;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mode-button.active {
            background: #007bff;
            color: white;
        }

        .notation-display {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
        }

        .beat-button {
            width: 80px;
            height: 80px;
            border: 3px solid #007bff;
            border-radius: 15px;
            background: #fff;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .beat-button:hover {
            background: #e7f3ff;
            transform: scale(1.05);
        }

        .beat-button.active {
            background: #007bff;
            color: white;
            transform: scale(0.95);
        }

        .beat-button.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .beat-button.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .rhythm-pattern {
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            margin: 10px 0;
            padding: 15px;
            background: #fff;
            border: 2px solid #dee2e6;
            border-radius: 10px;
        }

        .controls {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }

        .beat-number {
            position: absolute;
            top: -10px;
            left: -10px;
            background: #6c757d;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
        }

        .tempo-slider {
            margin: 20px 0;
        }

        .tempo-slider input {
            width: 200px;
        }

        @media (max-width: 768px) {
            .beat-grid {
                grid-template-columns: repeat(2, 1fr);
                max-width: 200px;
            }

            .beat-button {
                width: 60px;
                height: 60px;
                font-size: 1.2em;
            }
        }
---
    <div class="container">
        <div class="header">
            <a href="music-trivia.html" class="back-btn">‚Üê Back to Music Trivia</a>
            <h1>ü•Å Rhythm Game</h1>
        </div>

        <div class="rhythm-container">
            <p class="subtitle">Listen to the rhythm and tap it back!</p>

            <div class="game-stats">
                <div class="stat-card">
                    <div class="stat-value" id="score">0</div>
                    <div>Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">1</div>
                    <div>Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streak">0</div>
                    <div>Streak</div>
                </div>
            </div>

            <div class="rhythm-display" id="rhythmDisplay">
                Press "New Rhythm" to start!
            </div>

            <div class="rhythm-pattern" id="rhythmPattern"></div>

            <div class="tempo-slider">
                <label for="tempoSlider">Tempo: </label>
                <input type="range" id="tempoSlider" min="60" max="150" value="100">
                <span id="tempoValue">100</span> BPM
            </div>

            <div class="mode-selector">
                <h3>Choose Game Mode:</h3>
                <button class="mode-button active" id="listenModeBtn">Listen ‚Üí Choose Notation</button>
                <button class="mode-button" id="readModeBtn">Read Notation ‚Üí Choose Audio</button>
            </div>

            <div class="controls">
                <button class="btn" id="newRhythmBtn">New Rhythm</button>
                <button class="btn secondary" id="playBtn" disabled>Play Again</button>
                <button class="btn secondary" id="checkBtn" disabled>Check Answer</button>
            </div>

            <!-- Listen Mode: User hears rhythm and chooses notation -->
            <div id="listenMode" class="game-mode">
                <div class="choice-grid" id="notationChoices" style="display: none;">
                    <!-- Will be populated with notation choices -->
                </div>
            </div>

            <!-- Read Mode: User sees notation and chooses audio -->
            <div id="readMode" class="game-mode" style="display: none;">
                <div class="notation-display" id="notationDisplay"></div>
                <div class="choice-grid" id="audioChoices" style="display: none;">
                    <!-- Will be populated with audio choices -->
                </div>
            </div>

            <div class="info-box" style="margin-top: 30px;">
                <h3>How to Play:</h3>
                <div id="listenModeInstructions">
                    <p><strong>Listen ‚Üí Choose Notation Mode:</strong></p>
                    <p>1. Click "New Rhythm" to start</p>
                    <p>2. Listen carefully to the rhythm pattern</p>
                    <p>3. Choose the correct musical notation from the options</p>
                    <p>4. Use "Play Again" to replay if needed</p>
                </div>
                <div id="readModeInstructions" style="display: none;">
                    <p><strong>Read Notation ‚Üí Choose Audio Mode:</strong></p>
                    <p>1. Click "New Rhythm" to start</p>
                    <p>2. Study the musical notation shown</p>
                    <p>3. Listen to the audio options and choose the correct one</p>
                    <p>4. Match the notation to the correct rhythm</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class RhythmGame {
            constructor() {
                this.currentPattern = [];
                this.correctAnswer = 0;
                this.score = 0;
                this.level = 1;
                this.streak = 0;
                this.isPlaying = false;
                this.tempo = 100; // BPM
                this.gameMode = 'listen'; // 'listen' or 'read'

                // Audio context for generating beats
                this.audioContext = null;
                this.initAudio();

                this.initializeElements();
                this.attachEventListeners();
                this.updateDisplay();
                this.switchMode('listen');
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.warn('Audio context not available:', error);
                }
            }

            initializeElements() {
                this.scoreElement = document.getElementById('score');
                this.levelElement = document.getElementById('level');
                this.streakElement = document.getElementById('streak');
                this.rhythmDisplay = document.getElementById('rhythmDisplay');
                this.rhythmPattern = document.getElementById('rhythmPattern');
                this.tempoSlider = document.getElementById('tempoSlider');
                this.tempoValue = document.getElementById('tempoValue');

                this.newRhythmBtn = document.getElementById('newRhythmBtn');
                this.playBtn = document.getElementById('playBtn');
                this.checkBtn = document.getElementById('checkBtn');

                this.listenModeBtn = document.getElementById('listenModeBtn');
                this.readModeBtn = document.getElementById('readModeBtn');

                this.listenMode = document.getElementById('listenMode');
                this.readMode = document.getElementById('readMode');
                this.notationChoices = document.getElementById('notationChoices');
                this.audioChoices = document.getElementById('audioChoices');
                this.notationDisplay = document.getElementById('notationDisplay');

                this.listenModeInstructions = document.getElementById('listenModeInstructions');
                this.readModeInstructions = document.getElementById('readModeInstructions');
            }

            attachEventListeners() {
                this.newRhythmBtn.addEventListener('click', () => this.generateNewRhythm());
                this.playBtn.addEventListener('click', () => this.playCurrentRhythm());
                this.checkBtn.addEventListener('click', () => this.checkAnswer());

                this.listenModeBtn.addEventListener('click', () => this.switchMode('listen'));
                this.readModeBtn.addEventListener('click', () => this.switchMode('read'));

                this.tempoSlider.addEventListener('input', (e) => {
                    this.tempo = parseInt(e.target.value);
                    this.tempoValue.textContent = this.tempo;
                });
            }

            switchMode(mode) {
                this.gameMode = mode;

                // Update mode buttons
                this.listenModeBtn.classList.toggle('active', mode === 'listen');
                this.readModeBtn.classList.toggle('active', mode === 'read');

                // Update mode displays
                this.listenMode.style.display = mode === 'listen' ? 'block' : 'none';
                this.readMode.style.display = mode === 'read' ? 'block' : 'none';

                // Update instructions
                this.listenModeInstructions.style.display = mode === 'listen' ? 'block' : 'none';
                this.readModeInstructions.style.display = mode === 'read' ? 'block' : 'none';

                // Reset game state
                this.resetGame();
                this.rhythmDisplay.textContent = `${mode === 'listen' ? 'Listen Mode' : 'Read Mode'}: Press "New Rhythm" to start!`;
            }

            resetGame() {
                this.currentPattern = [];
                this.correctAnswer = 0;
                this.notationChoices.style.display = 'none';
                this.audioChoices.style.display = 'none';
                this.notationDisplay.textContent = '';
                this.playBtn.disabled = true;
                this.checkBtn.disabled = true;
                this.clearChoiceSelection();
            }

            generateNewRhythm() {
                this.resetGame();

                // Generate a 4-beat pattern
                this.currentPattern = [];
                const beatTypes = [0, 1, 2]; // 0=rest, 1=quarter, 2=eighth notes

                for (let i = 0; i < 4; i++) {
                    this.currentPattern.push(beatTypes[Math.floor(Math.random() * beatTypes.length)]);
                }

                // Ensure at least 2 beats are not rests
                const nonRestBeats = this.currentPattern.filter(beat => beat !== 0).length;
                if (nonRestBeats < 2) {
                    this.currentPattern[0] = 1;
                    this.currentPattern[2] = 1;
                }

                if (this.gameMode === 'listen') {
                    this.startListenMode();
                } else {
                    this.startReadMode();
                }

                this.playBtn.disabled = false;
                this.checkBtn.disabled = false;
            }

            startListenMode() {
                this.rhythmDisplay.textContent = 'Listen to the rhythm...';
                this.playCurrentRhythm();

                // Generate notation choices after a delay
                setTimeout(() => {
                    this.generateNotationChoices();
                }, 1000);
            }

            startReadMode() {
                this.displayNotation();
                this.generateAudioChoices();
                this.rhythmDisplay.textContent = 'Study the notation, then choose the matching audio';
            }

            generateNotationChoices() {
                const choices = [];

                // Correct answer
                choices.push({
                    notation: this.patternToNotation(this.currentPattern),
                    pattern: [...this.currentPattern],
                    isCorrect: true
                });

                // Generate 3 incorrect options
                for (let i = 0; i < 3; i++) {
                    let wrongPattern;
                    do {
                        wrongPattern = this.generateRandomPattern();
                    } while (this.patternsEqual(wrongPattern, this.currentPattern));

                    choices.push({
                        notation: this.patternToNotation(wrongPattern),
                        pattern: wrongPattern,
                        isCorrect: false
                    });
                }

                // Shuffle choices
                this.shuffleArray(choices);
                this.correctAnswer = choices.findIndex(choice => choice.isCorrect);

                // Display choices
                this.displayNotationChoices(choices);
                this.notationChoices.style.display = 'grid';
            }

            generateAudioChoices() {
                const choices = [];

                // Correct answer
                choices.push({
                    pattern: [...this.currentPattern],
                    isCorrect: true,
                    label: 'Option A'
                });

                // Generate 3 incorrect options
                for (let i = 0; i < 3; i++) {
                    let wrongPattern;
                    do {
                        wrongPattern = this.generateRandomPattern();
                    } while (this.patternsEqual(wrongPattern, this.currentPattern));

                    choices.push({
                        pattern: wrongPattern,
                        isCorrect: false,
                        label: `Option ${String.fromCharCode(66 + i)}` // B, C, D
                    });
                }

                // Shuffle choices
                this.shuffleArray(choices);
                this.correctAnswer = choices.findIndex(choice => choice.isCorrect);

                // Store choices for audio playback
                this.currentAudioChoices = choices;

                // Display choices
                this.displayAudioChoices(choices);
                this.audioChoices.style.display = 'grid';
            }

            displayNotation() {
                this.notationDisplay.textContent = this.patternToNotation(this.currentPattern);
            }

            displayNotationChoices(choices) {
                this.notationChoices.innerHTML = '';
                choices.forEach((choice, index) => {
                    const button = document.createElement('div');
                    button.className = 'choice-button';
                    button.dataset.choice = index;
                    button.innerHTML = `<div style="font-size: 1.5em; margin-bottom: 10px;">${choice.notation}</div>`;
                    button.addEventListener('click', () => this.selectChoice(index));
                    this.notationChoices.appendChild(button);
                });
            }

            displayAudioChoices(choices) {
                this.audioChoices.innerHTML = '';
                choices.forEach((choice, index) => {
                    const button = document.createElement('div');
                    button.className = 'choice-button';
                    button.dataset.choice = index;
                    button.innerHTML = `
                        <div style="font-size: 1.2em; margin-bottom: 10px;">${choice.label}</div>
                        <button onclick="event.stopPropagation(); game.playPattern(${index})" class="btn secondary" style="font-size: 0.8em;">üîä Play</button>
                    `;
                    button.addEventListener('click', () => this.selectChoice(index));
                    this.audioChoices.appendChild(button);
                });
            }

            async playPattern(choiceIndex) {
                if (this.gameMode !== 'read' || !this.currentAudioChoices) return;

                if (this.currentAudioChoices[choiceIndex]) {
                    await this.playRhythmPattern(this.currentAudioChoices[choiceIndex].pattern);
                }
            }

            selectChoice(choiceIndex) {
                this.clearChoiceSelection();

                const container = this.gameMode === 'listen' ? this.notationChoices : this.audioChoices;
                const button = container.querySelector(`[data-choice="${choiceIndex}"]`);
                if (button) {
                    button.classList.add('selected');
                    this.selectedChoice = choiceIndex;
                }
            }

            clearChoiceSelection() {
                document.querySelectorAll('.choice-button').forEach(btn => {
                    btn.classList.remove('selected', 'correct', 'incorrect');
                });
                this.selectedChoice = null;
            }

            patternToNotation(pattern) {
                let notation = '';
                for (let beat of pattern) {
                    switch (beat) {
                        case 0:
                            notation += 'ùÑΩ '; // Rest
                            break;
                        case 1:
                            notation += '‚ô© '; // Quarter note
                            break;
                        case 2:
                            notation += '‚ô´ '; // Eighth notes
                            break;
                    }
                }
                return notation.trim();
            }

            generateRandomPattern() {
                const pattern = [];
                const beatTypes = [0, 1, 2];

                for (let i = 0; i < 4; i++) {
                    pattern.push(beatTypes[Math.floor(Math.random() * beatTypes.length)]);
                }

                // Ensure at least 2 beats are not rests
                const nonRestBeats = pattern.filter(beat => beat !== 0).length;
                if (nonRestBeats < 2) {
                    pattern[0] = 1;
                    pattern[2] = 1;
                }

                return pattern;
            }

            patternsEqual(a, b) {
                return a.length === b.length && a.every((val, i) => val === b[i]);
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            async playCurrentRhythm() {
                await this.playRhythmPattern(this.currentPattern);
            }

            async playRhythmPattern(pattern) {
                if (!this.audioContext || this.isPlaying) return;

                this.isPlaying = true;
                const originalText = this.rhythmDisplay.textContent;
                this.rhythmDisplay.textContent = 'Playing rhythm... üéµ';

                const beatDuration = 60000 / this.tempo; // milliseconds per beat

                for (let i = 0; i < pattern.length; i++) {
                    const beatType = pattern[i];

                    if (beatType === 1) {
                        // Quarter note
                        this.playBeep(440, 0.2);
                    } else if (beatType === 2) {
                        // Two eighth notes
                        this.playBeep(440, 0.1);
                        setTimeout(() => this.playBeep(440, 0.1), beatDuration / 2);
                    }
                    // Rest (0) - no sound

                    await this.sleep(beatDuration);
                }

                this.isPlaying = false;
                this.rhythmDisplay.textContent = originalText;
            }

            playBeep(frequency, duration) {
                if (!this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            checkAnswer() {
                if (this.selectedChoice === null) {
                    this.rhythmDisplay.textContent = 'Please select an answer first!';
                    return;
                }

                const isCorrect = this.selectedChoice === this.correctAnswer;
                this.showResults(isCorrect);

                if (isCorrect) {
                    this.score += 10 + (this.level * 5);
                    this.streak++;

                    if (this.streak % 5 === 0) {
                        this.level++;
                        this.rhythmDisplay.textContent = `üéâ Level Up! Now level ${this.level}!`;
                    }
                } else {
                    this.streak = 0;
                }

                this.updateDisplay();

                // Reset for next round
                setTimeout(() => {
                    this.resetGame();
                    this.rhythmDisplay.textContent = 'Ready for next rhythm!';
                }, 3000);
            }

            showResults(isCorrect) {
                const container = this.gameMode === 'listen' ? this.notationChoices : this.audioChoices;
                const buttons = container.querySelectorAll('.choice-button');

                buttons.forEach((btn, index) => {
                    if (index === this.correctAnswer) {
                        btn.classList.add('correct');
                    } else if (index === this.selectedChoice && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                });

                if (isCorrect) {
                    this.rhythmDisplay.textContent = 'üéâ Correct! Great rhythm recognition!';
                } else {
                    this.rhythmDisplay.textContent = '‚ùå Not quite right. The correct answer is highlighted in green.';
                }
            }

            updateDisplay() {
                this.scoreElement.textContent = this.score;
                this.levelElement.textContent = this.level;
                this.streakElement.textContent = this.streak;
            }
        }

        // Global reference for audio choice playback
        let game;

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            game = new RhythmGame();
        });
    </script>

    </div>